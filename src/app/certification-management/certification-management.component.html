<nz-layout>
  <nz-header>
    <div>
      <img class="logo" src="assets/logo.png" />
      <span>证书颁发系统</span>
    </div>
    <div class="tabs">
      <span
        *ngFor="let tab of tabs"
        [ngClass]="{active: tabKey === tab.key}"
        (click)="onTabChange(tab.key)"
      >
        {{tab.title}}
      </span>
    </div>
    <div class="user">
      <nz-avatar nzText="A"></nz-avatar>
      <span>Admin1</span>
    </div>
  </nz-header>
  <div class="certificate-tabs">
    <p>{{isCertificatePublish ? '证书发布' : '证书查询'}}</p>
    <button *ngIf="isCertificatePublish"
            class="linked-certificate" nz-button nzType="primary"
            [ngClass]="{active: subTabKey === certificateTabs.ON_CHAIN_CERTIFICATE}"
            (click)="onSubTabChange(certificateTabs.ON_CHAIN_CERTIFICATE)">上链证书
    </button>
    <button *ngIf="isCertificatePublish"
            class="non-linked-certificate" nz-button nzType="primary"
            [ngClass]="{active: subTabKey === certificateTabs.OFF_CHAIN_CERTIFICATE}"
            (click)="onSubTabChange(certificateTabs.OFF_CHAIN_CERTIFICATE)">非上链证书
    </button>
  </div>
  <nz-content>
    <div class="left">
      <ng-container *ngIf="isCertificatePublish">
        <app-certificate-form [isOnChain]="isOnChain" [certificateForm]="certificateForm"></app-certificate-form>
        <div class="issue-btn-wrapper" *ngIf="tabKey!==certificateTabs.QUERY_CERTIFICATE">
          <button class="issue-btn" nz-button nzType="primary" nzGhost [disabled]="checkFormValidation()"
                  (click)="issue()" [nzLoading]="loading">颁发证书
          </button>
        </div>
      </ng-container>
      <app-query-page *ngIf="tabKey===certificateTabs.QUERY_CERTIFICATE"></app-query-page>
    </div>

    <div class="preview" *ngIf="isCertificatePublish">
      <div><p class="section-title">证书预览调试</p></div>
      <div class="certification-sample">
        <ng-container *ngIf="isOnChain">
          <ng-container *ngIf="certificateForm.get('certificateTemplate').value === 'tw'">
            <app-template-tw [certificate]="certificateForm.value" #template></app-template-tw>
            <app-template-tw-simple [certificate]="certificateForm.value" #TWSimple></app-template-tw-simple>
          </ng-container>
          <ng-container *ngIf="certificateForm.get('certificateTemplate').value === 'dpm'">
            <app-template-junior-dpm [certificate]="certificateForm.value" #template></app-template-junior-dpm>
            <div>
              <app-template-junior-dpm-simple [certificate]="certificateForm.value" #TWSimple></app-template-junior-dpm-simple>
            </div>
          </ng-container>
<!--          <ng-container *ngIf="certificateTemplate === 'tw-cor'">-->
<!--            <app-template-tw-cor [certificate]="certificateForm.value" #template></app-template-tw-cor>-->
<!--            <div>-->
<!--              <app-template-tw-cor-simple [certificate]="certificateForm.value" #TWSimple></app-template-tw-cor-simple>-->
<!--            </div>-->
<!--          </ng-container>-->
        </ng-container>
        <ng-container *ngIf="!isOnChain">
          <app-template-non-linked-tw-ac
            [certificate]="certificateForm.value" #template>
          </app-template-non-linked-tw-ac>
        </ng-container>
      </div>
      <div>
        <a *ngIf="downloadLink" [href]="svgUrl" target="_blank" download="{{certificateForm.value|name}}的证书.svg">下载 SVG 版本</a>
        <a *ngIf="downloadLink" [href]="pngUrl" target="_blank" download="{{certificateForm.value|name}}的证书.png">下载 PNG 版本</a>
      </div>
    </div>
  </nz-content>
</nz-layout>
